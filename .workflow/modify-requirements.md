# 수정 요구사항

## 기능: 고정비(Fixed Expense) 기능 추가

### 사용자 요청 요약
- 거래 추가 시 반복주기 선택 시 고정비 체크박스 추가
- 설정 > 고정비 관리 메뉴 추가
- 통계에서 고정비 필터 추가

### 사용자 결정 사항
1. **카테고리 관리**: 별도 테이블 (fixed_expense_categories)
2. **통계 표시**: 기존 탭에 통합 (고정비/변동비 필터)
3. **지출 편입 기본값**: 편입 X (기본적으로 지출에서 제외)
4. **적용 범위**: 지출만

---

## 기능 요구사항

### 1. 거래 추가 화면
- [ ] 반복주기가 '없음'이 아닐 때 '고정비로 등록' 체크박스 표시
- [ ] 고정비 체크 시 고정비 카테고리 선택 UI로 전환
- [ ] 고정비 카테고리 인라인 추가 기능

### 2. 설정 > 고정비 관리 페이지
- [ ] 결제수단 관리 아래에 '고정비 관리' 메뉴 추가
- [ ] 고정비 관리 페이지 구성:
  - '고정비를 지출에 편입' 스위치 (기본값: OFF)
  - 고정비 카테고리 관리 (추가/수정/삭제)

### 3. 통계 화면
- [ ] 카테고리 탭: 지출 선택 시 '전체/고정비/변동비' 필터 추가
- [ ] 추이 탭: 타입 선택에 '고정비' 추가 (수입/지출/저축/고정비)
- [ ] 고정비는 편입 설정에 따라 지출에 포함 여부 결정

### 4. 달력/거래 표시
- [ ] 고정비 편입 OFF 시: 달력에 고정비 거래 미표시
- [ ] 고정비 편입 ON 시: 일반 지출처럼 표시

---

## 데이터베이스 요구사항

### 신규 테이블
1. **fixed_expense_categories**: 고정비 카테고리 테이블
   - id, ledger_id, name, icon, color, sort_order, created_at

2. **fixed_expense_settings**: 고정비 설정 테이블
   - id, ledger_id (UNIQUE), include_in_expense (기본값: false)

### 기존 테이블 수정
- **transactions**: 
  - is_fixed_expense BOOLEAN DEFAULT FALSE
  - fixed_expense_category_id UUID REFERENCES fixed_expense_categories(id)

---

## 엣지 케이스 처리

### 데이터 관련
- [ ] 고정비 카테고리가 없을 때 안내 메시지 표시
- [ ] 고정비 카테고리 삭제 시 관련 거래의 카테고리 null 처리
- [ ] 편입 설정 변경 시 기존 데이터는 영향 없음 (표시만 변경)

### UI 관련
- [ ] 반복주기 '없음' 선택 시 고정비 체크박스 숨김
- [ ] 고정비 체크 시 일반 카테고리 선택 영역 숨김
- [ ] 고정비 카테고리 비어있을 때 빈 상태 UI

### 통계 관련
- [ ] 고정비 편입 설정에 따라 지출 합계 계산 분기
- [ ] 고정비 카테고리가 비어있을 때도 탭/필터 표시

---

## 제약사항
- 기존 반복 거래는 고정비로 자동 변환하지 않음
- 고정비는 지출 타입에만 적용
- 고정비 카테고리는 가계부별로 관리 (공유됨)
