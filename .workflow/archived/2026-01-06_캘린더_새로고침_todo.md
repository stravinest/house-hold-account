# Todo: 캘린더 새로고침 기능 개선

## 메타 정보
- 생성일: 2026-01-06 11:15
- 현재 Phase: 1 (계획 수립)
- 상태: 진행중
- 반복 횟수: 0
- 예상 작업량: 0.5일

## 관련 문서
- PRD: .workflow/prd.md
- Backlog: .workflow/backlog.md (섹션 8)

---

## 작업 목록

### 1. 준비 단계
| 번호 | 작업 | 담당 Agent | 상태 | 결과 |
|------|------|-----------|------|------|
| 1.1 | 코드베이스 분석 | Planner | 완료 | home_page.dart, calendar_view.dart, transaction_provider.dart 분석 완료 |
| 1.2 | PRD 작성 | Planner | 완료 | .workflow/prd.md |
| 1.3 | Todo 작성 | Planner | 완료 | .workflow/todo.md |

### 2. 구현 단계
| 번호 | 작업 | 담당 Agent | 상태 | 결과 |
|------|------|-----------|------|------|
| 2.1 | home_page.dart에 새로고침 함수 추가 | general-purpose | 대기 | - |
| 2.2 | 탭 전환 시 자동 새로고침 로직 추가 | general-purpose | 대기 | - |
| 2.3 | AppBar에 새로고침 아이콘 추가 | general-purpose | 대기 | - |
| 2.4 | CalendarTabView에 RefreshIndicator 추가 | general-purpose | 대기 | - |

### 3. 검증 단계
| 번호 | 작업 | 담당 Agent | 상태 | 결과 |
|------|------|-----------|------|------|
| 3.1 | 코드 리뷰 | code-reviewer | 대기 | - |

### 4. 최종 테스트 단계
| 번호 | 작업 | 담당 Agent | 상태 | 결과 |
|------|------|-----------|------|------|
| 4.1 | flutter analyze | 자동화 | 대기 | - |
| 4.2 | flutter build | 자동화 | 대기 | - |
| 4.3 | 앱 실행 테스트 | app-test-agent | 대기 | - |

---

## 구현 상세 가이드

### 2.1 새로고침 함수 추가

`_HomePageState` 클래스에 Provider 갱신 함수 추가:

```dart
void _refreshCalendarData() {
  ref.invalidate(dailyTransactionsProvider);
  ref.invalidate(monthlyTransactionsProvider);
  ref.invalidate(monthlyTotalProvider);
  ref.invalidate(dailyTotalsProvider);
}
```

### 2.2 탭 전환 시 자동 새로고침

`onDestinationSelected` 콜백 수정:

```dart
onDestinationSelected: (index) {
  setState(() {
    _selectedIndex = index;
  });
  if (index == 0) {
    _refreshCalendarData();
  }
}
```

### 2.3 AppBar 새로고침 아이콘

AppBar actions에 조건부 아이콘 추가:

```dart
actions: [
  if (_selectedIndex == 0)
    IconButton(
      icon: const Icon(Icons.refresh),
      onPressed: _refreshCalendarData,
    ),
  IconButton(
    icon: const Icon(Icons.search),
    onPressed: () {
      context.push(Routes.search);
    },
  ),
  IconButton(
    icon: const Icon(Icons.settings),
    onPressed: () {
      context.push(Routes.settings);
    },
  ),
],
```

### 2.4 RefreshIndicator 추가

`CalendarTabView` 위젯에 RefreshIndicator 추가:

```dart
class CalendarTabView extends ConsumerWidget {
  final DateTime selectedDate;
  final DateTime focusedDate;
  final ValueChanged<DateTime> onDateSelected;
  final ValueChanged<DateTime> onPageChanged;
  final VoidCallback onRefresh;  // 추가

  const CalendarTabView({
    super.key,
    required this.selectedDate,
    required this.focusedDate,
    required this.onDateSelected,
    required this.onPageChanged,
    required this.onRefresh,  // 추가
  });

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    return RefreshIndicator(
      onRefresh: () async {
        onRefresh();
        // Provider가 갱신될 때까지 대기
        await Future.delayed(const Duration(milliseconds: 500));
      },
      child: Column(
        children: [
          // 캘린더
          CalendarView(
            selectedDate: selectedDate,
            focusedDate: focusedDate,
            onDateSelected: onDateSelected,
            onPageChanged: onPageChanged,
          ),
          const Divider(height: 1),
          // 선택된 날짜의 거래 목록
          Expanded(
            child: TransactionList(date: selectedDate),
          ),
        ],
      ),
    );
  }
}
```

---

## 파일별 변경 사항 요약

| 파일 | 변경 내용 |
|------|----------|
| `lib/features/ledger/presentation/pages/home_page.dart` | _refreshCalendarData() 함수 추가, onDestinationSelected 수정, AppBar actions 수정, CalendarTabView에 onRefresh 파라미터 전달 |

---

## 리뷰 피드백 히스토리

| 날짜 | 리뷰어 | 피드백 | 조치 |
|------|--------|--------|------|
| - | - | - | - |

---

## 테스트 결과 히스토리

| 날짜 | 테스트 종류 | 결과 | 비고 |
|------|------------|------|------|
| - | - | - | - |

---

## 변경 로그
- 2026-01-06 11:15: 초기 생성 (Planner)
