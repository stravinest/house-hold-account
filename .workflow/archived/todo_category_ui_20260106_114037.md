# Todo: ì¹´í…Œê³ ë¦¬ ë° ê±°ë˜ ì¶”ê°€ UI ê°œì„ 

## ë©”íƒ€ ì •ë³´
- ìƒì„±ì¼: 2026-01-06 12:00
- í˜„ì¬ Phase: 1 (ê³„íš ìˆ˜ë¦½)
- ìƒíƒœ: ì§„í–‰ì¤‘
- ë°˜ë³µ íšŸìˆ˜: 0
- ì˜ˆìƒ ì‘ì—…ëŸ‰: 3-4ì¼

## ê´€ë ¨ ë¬¸ì„œ
- PRD: .workflow/prd.md
- Backlog: .workflow/backlog.md (ì„¹ì…˜ 3)

---

## ì‘ì—… ëª©ë¡

### 1. ì¤€ë¹„ ë‹¨ê³„
| ë²ˆí˜¸ | ì‘ì—… | ë‹´ë‹¹ Agent | ìƒíƒœ | ê²°ê³¼ |
|------|------|-----------|------|------|
| 1.1 | ì½”ë“œë² ì´ìŠ¤ ë¶„ì„ | Planner | ì™„ë£Œ | add_transaction_sheet.dart, 001_initial_schema.sql ë¶„ì„ ì™„ë£Œ |
| 1.2 | PRD ì‘ì„± | Planner | ì™„ë£Œ | .workflow/prd.md |
| 1.3 | Todo ì‘ì„± | Planner | ì§„í–‰ì¤‘ | .workflow/todo.md |

### 2. êµ¬í˜„ ë‹¨ê³„

#### 2.1 DB ë§ˆì´ê·¸ë ˆì´ì…˜
| ë²ˆí˜¸ | ì‘ì—… | ë‹´ë‹¹ Agent | ìƒíƒœ | íŒŒì¼ |
|------|------|-----------|------|------|
| 2.1.1 | 004_make_category_nullable.sql ìƒì„± | general-purpose | ëŒ€ê¸° | supabase/migrations/004_make_category_nullable.sql |

#### 2.2 ê±°ë˜ ì¶”ê°€ í™”ë©´ UI ê°œì„ 
| ë²ˆí˜¸ | ì‘ì—… | ë‹´ë‹¹ Agent | ìƒíƒœ | íŒŒì¼ |
|------|------|-----------|------|------|
| 2.2.1 | ë ˆì´ì•„ì›ƒ ìˆœì„œ ë³€ê²½ (ì§€ì¶œëª… ìœ„ë¡œ) | general-purpose | ëŒ€ê¸° | add_transaction_sheet.dart |
| 2.2.2 | ê¸ˆì•¡ ì…ë ¥ í°íŠ¸ í¬ê¸° ì¶•ì†Œ (32px â†’ 24px) | general-purpose | ëŒ€ê¸° | add_transaction_sheet.dart |
| 2.2.3 | ì¹´í…Œê³ ë¦¬ í•„ìˆ˜ ê²€ì¦ ì œê±° | general-purpose | ëŒ€ê¸° | add_transaction_sheet.dart |

#### 2.3 ì¹´í…Œê³ ë¦¬ ì¸ë¼ì¸ ê´€ë¦¬
| ë²ˆí˜¸ | ì‘ì—… | ë‹´ë‹¹ Agent | ìƒíƒœ | íŒŒì¼ |
|------|------|-----------|------|------|
| 2.3.1 | ì¹´í…Œê³ ë¦¬ ì‚­ì œ ë²„íŠ¼ ì¶”ê°€ | general-purpose | ëŒ€ê¸° | add_transaction_sheet.dart |
| 2.3.2 | ì¹´í…Œê³ ë¦¬ ì‚­ì œ ë©”ì„œë“œ êµ¬í˜„ | general-purpose | ëŒ€ê¸° | add_transaction_sheet.dart |
| 2.3.3 | ì„ íƒ ì•ˆí•¨ ì˜µì…˜ ì¶”ê°€ | general-purpose | ëŒ€ê¸° | add_transaction_sheet.dart |

#### 2.4 ê²°ì œìˆ˜ë‹¨ ì¸ë¼ì¸ ê´€ë¦¬
| ë²ˆí˜¸ | ì‘ì—… | ë‹´ë‹¹ Agent | ìƒíƒœ | íŒŒì¼ |
|------|------|-----------|------|------|
| 2.4.1 | ê²°ì œìˆ˜ë‹¨ ì¶”ê°€ ë‹¤ì´ì–¼ë¡œê·¸ êµ¬í˜„ | general-purpose | ëŒ€ê¸° | add_transaction_sheet.dart |
| 2.4.2 | ê²°ì œìˆ˜ë‹¨ ì¶”ê°€ ë²„íŠ¼ ì¶”ê°€ | general-purpose | ëŒ€ê¸° | add_transaction_sheet.dart |
| 2.4.3 | ê²°ì œìˆ˜ë‹¨ ì‚­ì œ ë²„íŠ¼ ì¶”ê°€ | general-purpose | ëŒ€ê¸° | add_transaction_sheet.dart |
| 2.4.4 | ê²°ì œìˆ˜ë‹¨ ì‚­ì œ ë©”ì„œë“œ êµ¬í˜„ | general-purpose | ëŒ€ê¸° | add_transaction_sheet.dart |

### 3. ê²€ì¦ ë‹¨ê³„
| ë²ˆí˜¸ | ì‘ì—… | ë‹´ë‹¹ Agent | ìƒíƒœ | ê²°ê³¼ |
|------|------|-----------|------|------|
| 3.1 | ì½”ë“œ ë¦¬ë·° | code-reviewer | ëŒ€ê¸° | - |

### 4. ìµœì¢… í…ŒìŠ¤íŠ¸ ë‹¨ê³„
| ë²ˆí˜¸ | ì‘ì—… | ë‹´ë‹¹ Agent | ìƒíƒœ | ê²°ê³¼ |
|------|------|-----------|------|------|
| 4.1 | flutter analyze | ìë™í™” | ëŒ€ê¸° | - |
| 4.2 | flutter build | ìë™í™” | ëŒ€ê¸° | - |
| 4.3 | ì•± ì‹¤í–‰ í…ŒìŠ¤íŠ¸ | ìˆ˜ë™ | ëŒ€ê¸° | - |

---

## êµ¬í˜„ ìƒì„¸ ê°€ì´ë“œ

### 2.1.1 DB ë§ˆì´ê·¸ë ˆì´ì…˜

```sql
-- supabase/migrations/004_make_category_nullable.sql

-- ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒì‚¬í•­ìœ¼ë¡œ ë³€ê²½
ALTER TABLE transactions ALTER COLUMN category_id DROP NOT NULL;

-- ì„ íƒì‚¬í•­: ê¸°ë³¸ ì¹´í…Œê³ ë¦¬ ìë™ ìƒì„± íŠ¸ë¦¬ê±° ì œê±°
-- ê¸°ì¡´ ì‚¬ìš©ìì—ê²Œ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì‹ ì¤‘íˆ ê²°ì •
-- DROP TRIGGER IF EXISTS on_ledger_created_categories ON ledgers;
```

### 2.2.1 ë ˆì´ì•„ì›ƒ ìˆœì„œ ë³€ê²½

í˜„ì¬ ìˆœì„œ:
1. ìˆ˜ì…/ì§€ì¶œ ì„ íƒ
2. ê¸ˆì•¡ ì…ë ¥
3. ë‚ ì§œ ì„ íƒ
4. ì¹´í…Œê³ ë¦¬ ì„ íƒ
5. ê²°ì œìˆ˜ë‹¨ ì„ íƒ
6. ì§€ì¶œëª… ì…ë ¥

ë³€ê²½ í›„ ìˆœì„œ:
1. ìˆ˜ì…/ì§€ì¶œ ì„ íƒ
2. ì§€ì¶œëª… ì…ë ¥ (ìœ„ë¡œ ì´ë™)
3. ê¸ˆì•¡ ì…ë ¥
4. ë‚ ì§œ ì„ íƒ
5. ì¹´í…Œê³ ë¦¬ ì„ íƒ
6. ê²°ì œìˆ˜ë‹¨ ì„ íƒ

### 2.2.2 ê¸ˆì•¡ ì…ë ¥ í°íŠ¸ í¬ê¸° ì¶•ì†Œ

```dart
// Before
style: TextStyle(
  fontSize: 32,
  fontWeight: FontWeight.bold,
  color: _type == 'expense' ? Colors.red : Colors.blue,
),

// After
style: TextStyle(
  fontSize: 24,  // 32 â†’ 24
  fontWeight: FontWeight.bold,
  color: _type == 'expense' ? Colors.red : Colors.blue,
),
```

### 2.2.3 ì¹´í…Œê³ ë¦¬ í•„ìˆ˜ ê²€ì¦ ì œê±°

```dart
// Before (79-84ì¤„)
if (_selectedCategory == null) {
  ScaffoldMessenger.of(context).showSnackBar(
    const SnackBar(content: Text('ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”')),
  );
  return;
}

// After - í•´ë‹¹ ì½”ë“œ ì œê±°
```

### 2.3.1-2.3.2 ì¹´í…Œê³ ë¦¬ ì‚­ì œ ê¸°ëŠ¥

```dart
Widget _buildCategoryGrid(List<Category> categories) {
  return Wrap(
    spacing: 8,
    runSpacing: 8,
    children: [
      // ì„ íƒ ì•ˆí•¨ ì˜µì…˜
      FilterChip(
        selected: _selectedCategory == null,
        label: const Text('ì„ íƒ ì•ˆí•¨'),
        onSelected: (_) {
          setState(() => _selectedCategory = null);
        },
      ),
      ...categories.map((category) {
        final isSelected = _selectedCategory?.id == category.id;
        return FilterChip(
          selected: isSelected,
          label: Row(
            mainAxisSize: MainAxisSize.min,
            children: [
              Text(category.icon),
              const SizedBox(width: 4),
              Text(category.name),
            ],
          ),
          onSelected: (_) {
            setState(() => _selectedCategory = category);
          },
          onDeleted: () => _deleteCategory(category),  // ì‚­ì œ ë²„íŠ¼
          deleteIcon: const Icon(Icons.close, size: 18),
        );
      }),
      ActionChip(
        avatar: const Icon(Icons.add, size: 18),
        label: const Text('ì¶”ê°€'),
        onPressed: () => _showAddCategoryDialog(),
      ),
    ],
  );
}

Future<void> _deleteCategory(Category category) async {
  // í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸
  final confirmed = await showDialog<bool>(
    context: context,
    builder: (context) => AlertDialog(
      title: const Text('ì¹´í…Œê³ ë¦¬ ì‚­ì œ'),
      content: Text('${category.name} ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context, false),
          child: const Text('ì·¨ì†Œ'),
        ),
        FilledButton(
          onPressed: () => Navigator.pop(context, true),
          child: const Text('ì‚­ì œ'),
        ),
      ],
    ),
  );

  if (confirmed != true) return;

  try {
    await ref.read(categoryNotifierProvider.notifier).deleteCategory(category.id);

    // ì‚­ì œëœ ì¹´í…Œê³ ë¦¬ê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ í•´ì œ
    if (_selectedCategory?.id == category.id) {
      setState(() => _selectedCategory = null);
    }

    if (mounted) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('ì¹´í…Œê³ ë¦¬ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤')),
      );
    }

    // ì¹´í…Œê³ ë¦¬ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    ref.invalidate(categoriesProvider);
    ref.invalidate(incomeCategoriesProvider);
    ref.invalidate(expenseCategoriesProvider);
  } catch (e) {
    if (mounted) {
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(content: Text('ì˜¤ë¥˜: $e')),
      );
    }
  }
}
```

### 2.4.1 ê²°ì œìˆ˜ë‹¨ ì¶”ê°€ ë‹¤ì´ì–¼ë¡œê·¸

```dart
void _showAddPaymentMethodDialog() {
  final nameController = TextEditingController();
  String selectedIcon = 'ğŸ’³';
  String selectedColor = '#4CAF50';

  final icons = ['ğŸ’³', 'ğŸ’°', 'ğŸ¦', 'ğŸ“±', 'ğŸ’µ', 'ğŸ«'];
  final colors = ['#4CAF50', '#2196F3', '#F44336', '#FF9800', '#9C27B0', '#00BCD4'];

  showDialog(
    context: context,
    builder: (dialogContext) => StatefulBuilder(
      builder: (context, setDialogState) => AlertDialog(
        title: const Text('ê²°ì œìˆ˜ë‹¨ ì¶”ê°€'),
        content: SingleChildScrollView(
          child: Column(
            mainAxisSize: MainAxisSize.min,
            crossAxisAlignment: CrossAxisAlignment.start,
            children: [
              // ì´ë¦„ ì…ë ¥
              TextField(
                controller: nameController,
                decoration: const InputDecoration(
                  labelText: 'ê²°ì œìˆ˜ë‹¨ ì´ë¦„',
                  hintText: 'ì˜ˆ: ì‹ ìš©ì¹´ë“œ, í˜„ê¸ˆ, ì²´í¬ì¹´ë“œ',
                  border: OutlineInputBorder(),
                ),
              ),
              const SizedBox(height: 16),
              // ì•„ì´ì½˜ ì„ íƒ
              const Text('ì•„ì´ì½˜'),
              const SizedBox(height: 8),
              Wrap(
                spacing: 8,
                runSpacing: 8,
                children: icons.map((icon) {
                  final isSelected = icon == selectedIcon;
                  return GestureDetector(
                    onTap: () => setDialogState(() => selectedIcon = icon),
                    child: Container(
                      width: 40,
                      height: 40,
                      decoration: BoxDecoration(
                        color: isSelected
                            ? Theme.of(context).colorScheme.primaryContainer
                            : Colors.grey[200],
                        borderRadius: BorderRadius.circular(8),
                        border: isSelected
                            ? Border.all(
                                color: Theme.of(context).colorScheme.primary,
                                width: 2,
                              )
                            : null,
                      ),
                      child: Center(
                        child: Text(icon, style: const TextStyle(fontSize: 20)),
                      ),
                    ),
                  );
                }).toList(),
              ),
              const SizedBox(height: 16),
              // ìƒ‰ìƒ ì„ íƒ
              const Text('ìƒ‰ìƒ'),
              const SizedBox(height: 8),
              Wrap(
                spacing: 8,
                runSpacing: 8,
                children: colors.map((color) {
                  final isSelected = color == selectedColor;
                  return GestureDetector(
                    onTap: () => setDialogState(() => selectedColor = color),
                    child: Container(
                      width: 40,
                      height: 40,
                      decoration: BoxDecoration(
                        color: Color(int.parse(color.substring(1), radix: 16) + 0xFF000000),
                        borderRadius: BorderRadius.circular(8),
                        border: isSelected
                            ? Border.all(color: Colors.black, width: 3)
                            : null,
                      ),
                      child: isSelected
                          ? const Icon(Icons.check, color: Colors.white)
                          : null,
                    ),
                  );
                }).toList(),
              ),
            ],
          ),
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(dialogContext),
            child: const Text('ì·¨ì†Œ'),
          ),
          FilledButton(
            onPressed: () async {
              if (nameController.text.trim().isEmpty) {
                ScaffoldMessenger.of(context).showSnackBar(
                  const SnackBar(content: Text('ê²°ì œìˆ˜ë‹¨ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”')),
                );
                return;
              }

              try {
                final newMethod = await ref
                    .read(paymentMethodNotifierProvider.notifier)
                    .createPaymentMethod(
                      name: nameController.text.trim(),
                      icon: selectedIcon,
                      color: selectedColor,
                    );

                // ìƒˆë¡œ ë§Œë“  ê²°ì œìˆ˜ë‹¨ ìë™ ì„ íƒ
                setState(() => _selectedPaymentMethod = newMethod);

                if (dialogContext.mounted) {
                  Navigator.pop(dialogContext);
                  ScaffoldMessenger.of(context).showSnackBar(
                    const SnackBar(content: Text('ê²°ì œìˆ˜ë‹¨ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤')),
                  );
                }

                // ê²°ì œìˆ˜ë‹¨ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                ref.invalidate(paymentMethodNotifierProvider);
              } catch (e) {
                if (context.mounted) {
                  ScaffoldMessenger.of(context).showSnackBar(
                    SnackBar(content: Text('ì˜¤ë¥˜: $e')),
                  );
                }
              }
            },
            child: const Text('ì¶”ê°€'),
          ),
        ],
      ),
    ),
  );
}
```

---

## íŒŒì¼ë³„ ë³€ê²½ ì‚¬í•­ ìš”ì•½

| íŒŒì¼ | ë³€ê²½ ë‚´ìš© |
|------|----------|
| `supabase/migrations/004_make_category_nullable.sql` | ì‹ ê·œ - transactions.category_id nullable ì²˜ë¦¬ |
| `lib/features/transaction/presentation/widgets/add_transaction_sheet.dart` | ë ˆì´ì•„ì›ƒ ìˆœì„œ ë³€ê²½, ê¸ˆì•¡ í°íŠ¸ ì¶•ì†Œ, ì¹´í…Œê³ ë¦¬/ê²°ì œìˆ˜ë‹¨ ì¸ë¼ì¸ ê´€ë¦¬ ê¸°ëŠ¥ ì¶”ê°€ |

---

## ë¦¬ë·° í”¼ë“œë°± íˆìŠ¤í† ë¦¬

| ë‚ ì§œ | ë¦¬ë·°ì–´ | í”¼ë“œë°± | ì¡°ì¹˜ |
|------|--------|--------|------|
| - | - | - | - |

---

## í…ŒìŠ¤íŠ¸ ê²°ê³¼ íˆìŠ¤í† ë¦¬

| ë‚ ì§œ | í…ŒìŠ¤íŠ¸ ì¢…ë¥˜ | ê²°ê³¼ | ë¹„ê³  |
|------|------------|------|------|
| - | - | - | - |

---

## ë³€ê²½ ë¡œê·¸
- 2026-01-06 12:00: ì´ˆê¸° ìƒì„± (Planner)
