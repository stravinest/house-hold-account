# PRD: 캘린더 새로고침 기능 개선

## 배경 및 목적

### 문제 상황
- 캘린더 탭으로 전환 시 데이터가 자동으로 새로고침되지 않음
- 사용자가 다른 기기나 공유 멤버가 추가한 거래를 즉시 확인할 수 없음
- 새로고침 아이콘이 없어 수동으로 데이터를 갱신할 방법이 없음

### 목적
- 캘린더 탭 전환 시 자동 새로고침으로 최신 데이터 표시
- 사용자가 원할 때 수동으로 새로고침할 수 있는 UI 제공
- 공유 가계부 사용 시 실시간성 향상

---

## 필수 요구사항

### 1. 탭 전환 시 자동 새로고침
- [ ] 캘린더 탭(인덱스 0) 선택 시 자동으로 데이터 갱신
- [ ] BottomNavigationBar의 `onDestinationSelected` 콜백에서 처리
- [ ] 다음 Provider 갱신:
  - `dailyTransactionsProvider` (선택된 날짜의 거래)
  - `monthlyTransactionsProvider` (현재 월의 거래)
  - `monthlyTotalProvider` (월별 합계)
  - `dailyTotalsProvider` (캘린더의 일별 합계)

### 2. 수동 새로고침 버튼
- [ ] AppBar에 새로고침 아이콘 추가
- [ ] 캘린더 탭일 때만 표시
- [ ] 클릭 시 동일한 Provider 갱신

### 3. Pull-to-Refresh
- [ ] CalendarTabView에 RefreshIndicator 추가
- [ ] 위에서 아래로 드래그 시 새로고침

---

## UI/UX 요구사항

### AppBar 새로고침 아이콘
- **위치**: 검색 아이콘과 설정 아이콘 사이
- **아이콘**: `Icons.refresh`
- **표시 조건**: `_selectedIndex == 0` (캘린더 탭)
- **동작**: 클릭 시 Provider invalidate

### Pull-to-Refresh
- **위치**: CalendarTabView의 스크롤 영역
- **표시**: Material Design RefreshIndicator
- **동작**: 드래그 시 Provider invalidate

---

## 기술 요구사항

### 1. 파일 수정
- `lib/features/ledger/presentation/pages/home_page.dart`
  - `onDestinationSelected` 콜백에 새로고침 로직 추가
  - AppBar actions에 새로고침 아이콘 추가
  - CalendarTabView에 RefreshIndicator 적용

### 2. Provider 갱신 방법
```dart
// ref.invalidate() 사용
ref.invalidate(dailyTransactionsProvider);
ref.invalidate(monthlyTransactionsProvider);
ref.invalidate(monthlyTotalProvider);
ref.invalidate(dailyTotalsProvider);
```

### 3. 코드 구조
```dart
// 새로고침 함수
void _refreshCalendarData() {
  ref.invalidate(dailyTransactionsProvider);
  ref.invalidate(monthlyTransactionsProvider);
  ref.invalidate(monthlyTotalProvider);
  ref.invalidate(dailyTotalsProvider);
}

// 탭 전환 시
onDestinationSelected: (index) {
  setState(() {
    _selectedIndex = index;
  });
  if (index == 0) {
    _refreshCalendarData();
  }
}

// AppBar 새로고침 아이콘
if (_selectedIndex == 0)
  IconButton(
    icon: const Icon(Icons.refresh),
    onPressed: _refreshCalendarData,
  ),
```

---

## 성공 기준

- [ ] 캘린더 탭으로 전환 시 데이터가 자동으로 갱신됨
- [ ] 새로고침 아이콘 클릭 시 데이터가 즉시 갱신됨
- [ ] Pull-to-refresh 동작 확인
- [ ] 다른 탭에서는 새로고침 아이콘이 표시되지 않음
- [ ] 코드 리뷰 통과
- [ ] Flutter 분석 통과 (flutter analyze)
- [ ] 빌드 성공 (flutter build)

---

## 제약 사항

- 기존 코드 구조를 최대한 유지
- CalendarTabView는 StatelessWidget이므로 RefreshIndicator는 CalendarTabView 내부에 적용
- 네트워크 요청이 발생하므로 로딩 인디케이터는 Riverpod의 AsyncValue가 자동 처리

---

## 향후 개선 가능 사항

- [ ] 실시간 동기화 (Supabase Realtime 활용)
- [ ] 새로고침 애니메이션 커스터마이징
- [ ] 새로고침 성공/실패 스낵바 표시
