# 결제수단 관리 - 상세 UI 흐름도

## 현재 상황 vs 개선 후

### 현재 (1단계)
```
공유 가계부
└── 결제수단 관리
    ├── 신한카드 (모든 멤버가 사용)
    ├── KB국민카드 (모든 멤버가 사용)
    └── 현금 (모든 멤버가 사용)

개인 가계부
└── 결제수단 관리
    ├── 신한카드
    ├── 체크카드
    └── 현금
```

### 개선 후 (제안)
```
공유 가계부
└── 결제수단 관리
    ├── 🧑 나의 결제수단
    │   ├── 신한카드
    │   ├── KB국민카드
    │   └── 현금
    ├── 🧑 파트너의 결제수단
    │   ├── BC카드
    │   ├── 우리카드
    │   └── 현금
    └── [전체보기] - 모든 멤버 결제수단

개인 가계부
└── 결제수단 관리
    ├── 신한카드
    ├── 체크카드
    └── 현금
```

---

## 각 시안 상세 비교

### 📱 시안 1: 탭 기반 (Tab-based)

**화면 레이아웃:**
```
┌─────────────────────────────────────────┐
│                                         │
│  < 결제수단 관리                    [+]  │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│   [내 결제수단] [파트너 이름]           │  ← SegmentedButton
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 신한카드                         │   │
│  │ 결제수단 설정 보기  [≡] [>]     │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ KB국민카드                       │   │
│  │ 결제수단 설정 보기  [≡] [>]     │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 현금                             │   │
│  │ 결제수단 설정 보기  [≡] [>]     │   │
│  └─────────────────────────────────┘   │
│                                         │
│                                         │
└─────────────────────────────────────────┘
```

**사용 흐름:**
1. 탭 클릭 → 해당 멤버의 결제수단 리스트로 전환
2. 각 결제수단 클릭 → 편집 페이지로 이동
3. [+] 버튼 → 현재 선택된 멤버의 결제수단 추가

**코드 예시:**
```dart
// 탭 전환
SegmentedButton<String>(
  segments: [
    ButtonSegment(label: Text('내 결제수단')),
    ButtonSegment(label: Text('김철수의 결제수단')),
  ],
  selected: {selectedMemberId},
  onSelectionChanged: (value) {
    setState(() => selectedMemberId = value.first);
  },
)

// 데이터 필터링
final paymentMethods = ref.watch(
  paymentMethodsByMemberProvider(selectedMemberId)
);
```

**장점:**
- 🟢 국내 앱에서 가장 일반적인 UI 패턴
- 🟢 사용자가 이해하기 쉬움
- 🟢 각 탭이 독립적이어서 관리 명확함
- 🟢 많은 앱(카카오톡, 네이버 등)에서 사용 중

**단점:**
- 🔴 탭이 많으면 가로 스크롤 필요 (3명 이상)
- 🔴 멤버 추가/삭제 시 탭 동적 관리 필요

---

### 📱 시안 2: 섹션 그룹화 (Section-based)

**화면 레이아웃:**
```
┌─────────────────────────────────────────┐
│                                         │
│  < 결제수단 관리                    [+]  │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  🧑 나의 결제수단  3개                  │
│  ─────────────────────────────────────  │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 신한카드                         │   │
│  │ 자동 수집: ON  [≡] [>]          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ KB국민카드                       │   │
│  │ 자동 수집: ON  [≡] [>]          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 현금                             │   │
│  │ 자동 수집: OFF  [≡] [>]         │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [이 섹션에 추가 +]                     │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  🧑 파트너의 결제수단  2개              │
│  ─────────────────────────────────────  │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ BC카드                           │   │
│  │ 자동 수집: ON  [≡] [>]          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 우리카드                         │   │
│  │ 자동 수집: ON  [≡] [>]          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  [이 섹션에 추가 +]                     │
│                                         │
└─────────────────────────────────────────┘
```

**사용 흐름:**
1. 페이지 로드 → 모든 멤버 결제수단 섹션 표시
2. 각 결제수단 클릭 → 편집 페이지로 이동
3. [이 섹션에 추가 +] → 해당 멤버의 결제수단 추가

**코드 예시:**
```dart
// 멤버별로 그룹화
final groupedPaymentMethods = ref.watch(
  paymentMethodsGroupedByMemberProvider
);

// 표시
groupedPaymentMethods.when(
  data: (groups) => ListView.builder(
    itemCount: groups.length,
    itemBuilder: (context, index) {
      final member = groups[index].member;
      final methods = groups[index].paymentMethods;
      
      return PaymentMethodSection(
        member: member,
        paymentMethods: methods,
      );
    },
  ),
)
```

**장점:**
- 🟢 모든 멤버의 결제수단을 한눈에 볼 수 있음
- 🟢 멤버별 결제수단 개수를 시각적으로 비교 가능
- 🟢 각 섹션마다 독립적으로 [+] 버튼 제공
- 🟢 멤버 추가 시 자동으로 섹션 추가

**단점:**
- 🔴 멤버가 많거나 결제수단이 많으면 페이지가 매우 길어짐
- 🔴 특정 결제수단 찾기 위해 스크롤 많이 필요
- 🔴 성능: 리스트가 길어지면 렌더링 느려질 수 있음

---

### 📱 시안 3: 드롭다운 필터 (Dropdown Filter)

**화면 레이아웃:**
```
┌─────────────────────────────────────────┐
│                                         │
│  < 결제수단 관리                    [+]  │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  보기 대상: [▼ 나의 결제수단]            │  ← 드롭다운
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 신한카드                         │   │
│  │ 자동 수집: ON  [≡] [>]          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ KB국민카드                       │   │
│  │ 자동 수집: ON  [≡] [>]          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 현금                             │   │
│  │ 자동 수집: OFF  [≡] [>]         │   │
│  └─────────────────────────────────┘   │
│                                         │
│                                         │
│  드롭다운 옵션:                          │
│  - 나의 결제수단  ✓                     │
│  - 파트너의 결제수단                    │
│  - 모두보기                             │
│                                         │
└─────────────────────────────────────────┘
```

**사용 흐름:**
1. 드롭다운 클릭 → 멤버 선택
2. 선택된 멤버의 결제수단만 표시
3. [+] 버튼 → 현재 선택된 멤버의 결제수단 추가

**코드 예시:**
```dart
// 드롭다운
DropdownButton<String>(
  value: selectedMemberId,
  items: members.map((member) {
    return DropdownMenuItem(
      value: member.id,
      child: Text('${member.name}의 결제수단'),
    );
  }).toList(),
  onChanged: (value) {
    setState(() => selectedMemberId = value);
  },
)

// 선택된 멤버의 결제수단만 필터링
final paymentMethods = ref.watch(
  paymentMethodsByMemberProvider(selectedMemberId)
);
```

**장점:**
- 🟢 UI가 매우 간결하고 정리됨
- 🟢 페이지가 길어지지 않음
- 🟢 개인 가계부와 동일한 느낌 유지
- 🟢 리스트뷰 성능 최적화 가능

**단점:**
- 🔴 다른 멤버 결제수단 보려면 매번 드롭다운 열어야 함
- 🔴 멤버별 결제수단 개수 비교 불편
- 🔴 공유 가계부의 특징이 덜 드러남

---

### 📱 시안 4: 카드/스택 방식 (Card Stack)

**화면 레이아웃:**
```
┌─────────────────────────────────────────┐
│                                         │
│  < 결제수단 관리                        │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 🧑 나의 결제수단                 │   │
│  │ 3개 결제수단                      │   │
│  │                                 │   │
│  │ ┌────────┐ ┌────────┐           │   │
│  │ │신한카드│ │KB국민카│           │   │
│  │ └────────┘ └────────┘           │   │
│  │                                 │   │
│  │ ┌────────┐                       │   │
│  │ │  현금  │                       │   │
│  │ └────────┘                       │   │
│  │                                 │   │
│  │ [결제수단 편집 →]                │   │
│  └─────────────────────────────────┘   │
│        ↓ 스와이프 또는 스크롤           │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 🧑 파트너의 결제수단             │   │
│  │ 2개 결제수단                      │   │
│  │                                 │   │
│  │ ┌────────┐ ┌────────┐           │   │
│  │ │ BC카드 │ │우리카드│           │   │
│  │ └────────┘ └────────┘           │   │
│  │                                 │   │
│  │ [결제수단 편집 →]                │   │
│  └─────────────────────────────────┘   │
│                                         │
└─────────────────────────────────────────┘
```

**사용 흐름:**
1. 카드 미리보기 → 각 멤버의 결제수단 개수와 일부 보기
2. [결제수단 편집 →] → 해당 멤버의 상세 편집 페이지로 이동
3. 스와이프 또는 스크롤 → 다른 멤버의 카드 보기

**코드 예시:**
```dart
// 카드 스택
ListView.separated(
  itemCount: groupedMethods.length,
  separatorBuilder: (_, __) => SizedBox(height: 16),
  itemBuilder: (context, index) {
    final group = groupedMethods[index];
    return PaymentMethodCard(
      member: group.member,
      methods: group.methods,
      onTap: () => Navigator.push(
        context,
        MaterialPageRoute(
          builder: (_) => PaymentMethodDetailPage(
            memberId: group.member.id,
          ),
        ),
      ),
    );
  },
)
```

**장점:**
- 🟢 모던하고 눈에 띄는 디자인
- 🟢 각 멤버를 시각적으로 분리
- 🟢 모든 멤버 정보를 한눈에 미리볼 수 있음
- 🟢 상호작용성 높음 (스와이프 등)

**단점:**
- 🔴 구현이 복잡함 (custom widget 필요)
- 🔴 성능 최적화 필요
- 🔴 반응형 디자인 어려움
- 🔴 웹에서는 보기 어려울 수 있음

---

### 📱 시안 5: 버튼 그룹 (Button Group)

**화면 레이아웃:**
```
┌─────────────────────────────────────────┐
│                                         │
│  < 결제수단 관리                    [+]  │
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  [나] [파트너] [모두보기]      [≡]      │  ← 버튼 그룹
│                                         │
├─────────────────────────────────────────┤
│                                         │
│  현재: 나의 결제수단 (3개)               │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 신한카드                         │   │
│  │ 자동 수집: ON  [≡] [>]          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ KB국민카드                       │   │
│  │ 자동 수집: ON  [≡] [>]          │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │ 현금                             │   │
│  │ 자동 수집: OFF  [≡] [>]         │   │
│  └─────────────────────────────────┘   │
│                                         │
│                                         │
└─────────────────────────────────────────┘
```

**사용 흐름:**
1. 버튼 클릭 → 해당 멤버 또는 모두보기 선택
2. 필터된 결제수단 리스트 표시
3. [모두보기] 클릭 → 섹션 방식으로 모든 멤버 표시

**코드 예시:**
```dart
// 버튼 그룹
Wrap(
  spacing: 8,
  children: [
    ElevatedButton(
      onPressed: () => setState(() => filter = 'me'),
      child: Text('나'),
    ),
    for (final member in otherMembers)
      ElevatedButton(
        onPressed: () => setState(() => filter = member.id),
        child: Text(member.name),
      ),
    ElevatedButton(
      onPressed: () => setState(() => filter = 'all'),
      child: Text('모두보기'),
    ),
  ],
)
```

**장점:**
- 🟢 탭과 드롭다운의 장점 결합
- 🟢 컴팩트하면서도 멤버 전환 빠름
- 🟢 멤버 수가 가변적일 때 유연함
- 🟢 [모두보기]로 섹션 방식도 지원 가능

**단점:**
- 🔴 멤버가 5명 이상이면 버튼이 많아짐
- 🔴 버튼 레이아웃 조정 필요할 수 있음
- 🔴 탭보다 덜 직관적일 수 있음

---

## 🎯 상황별 추천

### 상황 1: 커플/부부 (2명)
**추천:** 시안 1 (탭 방식)
- 구조 가장 단순
- 탭 전환 빠름
- 명확한 구분

### 상황 2: 가족 공동 관리 (3-4명)
**추천:** 시안 2 (섹션 방식) + 시안 1 (탭 방식)
- 하이브리드: 탭으로 선택, 상세는 섹션으로
- 전체 비교 가능

### 상황 3: 룸메이트 등 많은 사람 (5명 이상)
**추천:** 시안 3 (드롭다운) 또는 시안 5 (버튼 그룹)
- 탭이 너무 많아지면 불편
- 드롭다운이 정리된 느낌
- 버튼은 중간 수준의 멤버에 좋음

### 상황 4: 모던 UX 우선
**추천:** 시안 4 (카드 방식)
- 최신식 디자인
- 높은 상호작용성

---

## 결론: 최적 선택지

### 🏆 **최종 추천: 시안 1 (탭 방식)**

**이유:**
1. 국내 앱의 표준 패턴
2. 사용자가 쉽게 이해
3. 구현이 간단함
4. 반응형 대응 용이
5. 멤버 수 변화에 유연함 (3명까지는 탭, 4명 이상은 스크롤)

**추가 기능:**
- [+] 버튼으로 현재 선택 멤버의 결제수단 추가
- 각 결제수단 카드에 멤버명 작게 표시 (혼동 방지)
- 리드온리 모드: 다른 멤버 결제수단은 보기만, 자신의 결제수단만 편집

