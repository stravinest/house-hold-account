# 2026-01-25 업데이트 내역

## 1. 금융 앱 패키지명 업데이트 (웹 서치 검증)

실제 Google Play 스토어에서 확인된 정확한 패키지명으로 업데이트했습니다.

### 업데이트된 패키지

#### KB 카드/은행
- ✅ `com.kbcard.cxh.appcard` - KB Pay (KB국민카드 앱)
  - [Google Play 링크](https://play.google.com/store/apps/details?id=com.kbcard.cxh.appcard&hl=en_US)
  - KB Pay는 별도 앱이 아닌 KB국민카드 앱의 기능

#### 신한 카드/은행
- ✅ `com.shcard.smartpay` - **신한 SOL페이 (메인 카드 앱)**
  - [Google Play 링크](https://play.google.com/store/apps/details?id=com.shcard.smartpay&hl=en_US)
- ✅ `com.shinhancard.wallet` - 신한카드 올댓
  - [Google Play 링크](https://play.google.com/store/apps/details?id=com.shinhancard.wallet)
- 기존: `com.shinhancard.smartshinhan` 유지

#### 삼성 카드/페이
- ✅ `kr.co.samsungcard.mpocket` - **삼성카드 메인 앱** (수정됨)
  - [Google Play 링크](https://play.google.com/store/apps/details?id=kr.co.samsungcard.mpocket&hl=en_US)
  - 기존 `com.samsungcard.app` → 실제 패키지명으로 수정
- ✅ `net.ib.android.smcard` - monimo (삼성금융네트웍스)
- ✅ `com.samsungcard.shopping` - 삼성카드 쇼핑

#### 현대카드
- ✅ `com.hyundaicard.appcard` - **현대카드 메인 앱**
  - [Google Play 링크](https://play.google.com/store/apps/details?id=com.hyundaicard.appcard&hl=en_US)
- ✅ `com.hyundaicard.weather` - 현대카드 웨더
- ✅ `com.hyundaicard.cultureapp` - 현대카드 DIVE

#### 롯데카드
- ✅ `com.lcacapp` - **디지로카 (롯데카드 메인 앱)** (수정됨)
  - [Google Play 링크](https://play.google.com/store/apps/details?id=com.lcacApp&hl=en_US)
  - 기존 `com.lottecard.app` → 실제 패키지명으로 수정
- ✅ `com.lottecard.lcap` - 롯데카드 인슈플러스

#### 경기지역화폐
- ✅ `gov.gyeonggi.ggcard` - **경기지역화폐 공식 앱** (실제 기기에서 확인됨)

### 주요 변경사항 요약

| 금융사 | 기존 패키지명 | 실제 패키지명 | 상태 |
|--------|--------------|--------------|------|
| 삼성카드 | `com.samsungcard.app` | `kr.co.samsungcard.mpocket` | ✅ 수정 |
| 롯데카드 | `com.lottecard.app` | `com.lcacapp` | ✅ 수정 |
| 신한카드 | - | `com.shcard.smartpay` | ✅ 추가 |
| 경기지역화폐 | - | `gov.gyeonggi.ggcard` | ✅ 확인 |

### 코드 위치

```dart
// lib/features/payment_method/data/services/notification_listener_wrapper.dart
static final Set<String> _financialAppPackagesLower = {
  // ... (업데이트된 패키지명 목록)
};
```

## 2. 공유 결제수단 UI 개선

### 문제점

기존에는 공유 결제수단 칩을 **롱프레스**해야 수정/삭제 옵션이 나타났으나, 사용자가 이 기능을 발견하기 어려웠습니다.

### 개선 내용 (시안 A 채택)

각 결제수단 칩에 **삭제 버튼(X)**을 명시적으로 표시하여 직관적인 UX를 제공합니다.

#### 디자인 특징

1. **칩 우측 상단에 작은 X 버튼 배치**
   - 위치: 칩 우측 상단 모서리 (약간 바깥쪽으로 돌출)
   - 크기: 24x24px (아이콘 14px)
   - 배경: `colorScheme.error` (빨간색 원형)
   - 테두리: 흰색 2px (칩과 분리감)

2. **그림자 효과**
   ```dart
   BoxShadow(
     color: Colors.black.withValues(alpha: 0.1),
     blurRadius: 4,
     offset: const Offset(0, 2),
   )
   ```
   - 버튼이 칩 위에 떠 있는 느낌
   - 터치 영역 명확히 구분

3. **접근성 개선**
   ```dart
   Semantics(
     label: l10n.commonDelete,
     button: true,
     child: ...
   )
   ```
   - 스크린 리더 지원
   - 버튼임을 명시

#### 사용법

- **칩 탭**: 결제수단 수정 페이지로 이동
- **X 버튼 탭**: 삭제 확인 다이얼로그 표시

### Before & After

#### Before (롱프레스)
```
┌──────────────┐
│    현금      │  ← 롱프레스로만 수정/삭제 가능
└──────────────┘
사용자가 기능을 발견하기 어려움
```

#### After (X 버튼)
```
┌──────────────┐ ⓧ
│    현금      │ ← 탭하면 수정
└──────────────┘
↑ X 버튼 명시적으로 표시 (삭제)
```

### 코드 위치

```dart
// lib/features/payment_method/presentation/pages/payment_method_management_page.dart
class _SharedPaymentMethodChip extends StatelessWidget {
  // Stack으로 칩과 X 버튼을 겹쳐서 배치
  // Positioned로 X 버튼을 우측 상단에 고정
}
```

## 3. 개발자 가이드 업데이트

### 패키지명 확인 방법

실물 기기에서 실제 패키지명을 확인하는 스크립트가 준비되어 있습니다:

```bash
# 금융 앱 패키지 검색
./scripts/find_financial_packages.sh R3CT90TAG8Z

# 실시간 알림 모니터링
./scripts/quick_monitor.sh

# 전체 설정 가이드
./scripts/setup_notification_monitoring.sh R3CT90TAG8Z
```

### 새로운 금융 앱 추가 시

1. **패키지명 확인**
   ```bash
   adb -s [기기ID] shell pm list packages | grep [검색어]
   ```

2. **코드에 추가**
   ```dart
   static final Set<String> _financialAppPackagesLower = {
     'com.new.app.package',  // 새로운 앱 패키지명
   };
   ```

3. **발신자 패턴 추가** (선택사항)
   ```dart
   // sms_parsing_service.dart
   static const Map<String, List<String>> senderPatterns = {
     '새로운금융사': ['키워드1', '키워드2'],
   };
   ```

## 4. 참고 문서

- `docs/push_notification_monitoring_guide.md` - 푸시 알림 패키지명 확인 가이드
- `docs/notification_troubleshooting.md` - 알림 감지 문제 해결 가이드
- `scripts/monitor_notifications.sh` - 실시간 로그 모니터링 스크립트
- `scripts/find_financial_packages.sh` - 금융 앱 검색 스크립트

## 5. 테스트 권장사항

### UI 테스트

1. 공유 결제수단 추가 후 X 버튼이 표시되는지 확인
2. X 버튼 탭 시 삭제 확인 다이얼로그가 나타나는지 확인
3. 칩 탭 시 수정 페이지로 이동하는지 확인
4. 다크모드에서도 X 버튼이 명확히 보이는지 확인

### 알림 감지 테스트

1. 업데이트된 앱으로 재빌드
   ```bash
   flutter run -d R3CT90TAG8Z
   ```

2. 실제 결제 진행
   - 신한 SOL페이로 소액 결제
   - 삼성카드 mpocket으로 소액 결제
   - 롯데 디지로카로 소액 결제

3. 로그 확인
   ```bash
   ./scripts/quick_monitor.sh
   ```

4. 대기 중 리스트에 알림이 표시되는지 확인

## 6. Breaking Changes

없음. 기존 기능은 모두 유지되며, UI만 개선되었습니다.

## 7. Migration Guide

기존 사용자는 별도 마이그레이션 없이 업데이트된 앱을 사용할 수 있습니다.

단, **롱프레스 동작이 제거**되었으므로:
- 기존: 칩 롱프레스 → 바텀시트 → 수정/삭제 선택
- 변경: 칩 탭 → 수정 / X 버튼 → 삭제

---

**업데이트 일자**: 2026-01-25
**테스트 기기**: R3CT90TAG8Z (Samsung SM_S908N)
**검증 방법**: Google Play 스토어 실제 패키지명 확인, 실물 기기 테스트
